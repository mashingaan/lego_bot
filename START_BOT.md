# üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

## üìã –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vercel (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

–ï—Å–ª–∏ –≤–∞—à API —É–∂–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Vercel, –±–æ—Ç —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü—Ä–æ—Å—Ç–æ:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ Vercel:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç API –≤ Vercel
   - Settings ‚Üí Environment Variables
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É–∫–∞–∑–∞–Ω—ã:
     - `DATABASE_URL`
     - `REDIS_URL`
     - `TELEGRAM_BOT_TOKEN`
     - `ENCRYPTION_KEY`
     - `FRONTEND_URL`
     - `ROUTER_URL`

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É API:**
   ```
   https://lego-bot-core.vercel.app/health
   ```

3. **–û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`**

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

#### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
docker-compose up -d postgres redis
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã:
```bash
docker ps
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã:
- `postgres` (–ø–æ—Ä—Ç 5433)
- `redis` (–ø–æ—Ä—Ç 6379)

#### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω):

```env
# PostgreSQL
POSTGRES_PORT=5433
DATABASE_URL=postgresql://postgres:postgres@localhost:5433/dialogue_constructor

# Redis
REDIS_URL=redis://localhost:6379

# Telegram
TELEGRAM_BOT_TOKEN=–≤–∞—à-—Ç–æ–∫–µ–Ω-–æ—Ç-@BotFather

# –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
ENCRYPTION_KEY=–≤–∞—à-–∫–ª—é—á-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è-–º–∏–Ω–∏–º—É–º-32-—Å–∏–º–≤–æ–ª–∞

# URL —Å–µ—Ä–≤–∏—Å–æ–≤
FRONTEND_URL=https://lego-bot-frontend.vercel.app
ROUTER_URL=https://vancouver-dimensional-pushed-condo.trycloudflare.com

# –ü–æ—Ä—Ç API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
PORT=3000
```

#### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
npm install
```

#### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç

```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
cd packages/core
npm run dev
```

–ò–ª–∏ –∏–∑ –∫–æ—Ä–Ω—è:
```bash
npm run dev --filter=@dialogue-constructor/core
```

#### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:**
   ```
   ‚úÖ PostgreSQL connected successfully
   ‚úÖ Redis client connected
   ‚úÖ Database tables initialized
   ‚úÖ Telegram bot started successfully
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API:**
   ```
   http://localhost:3000/health
   ```
   –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON —Å `status: "ok"`

3. **–û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram:**
   - –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
   - –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: Health Check

```bash
curl http://localhost:3000/health
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
```json
{
  "status": "ok",
  "databases": {
    "postgres": "connected",
    "redis": "connected"
  }
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: Telegram –±–æ—Ç

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
4. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/create_bot`
2. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
3. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
4. –ü—Ä–∏—à–ª–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
5. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/my_bots`
2. –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –±–æ—Ç–æ–≤

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–¥–µ—Ç–∞–ª—å–Ω–æ)

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

- **`TELEGRAM_BOT_TOKEN`** - —Ç–æ–∫–µ–Ω –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞
  - –ü–æ–ª—É—á–∏—Ç—å —É @BotFather: `/newbot`
  
- **`DATABASE_URL`** - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
  - –õ–æ–∫–∞–ª—å–Ω–æ: `postgresql://postgres:postgres@localhost:5433/dialogue_constructor`
  - –ù–∞ Vercel: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å (Supabase, Railway, Neon –∏ —Ç.–¥.)

- **`REDIS_URL`** - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
  - –õ–æ–∫–∞–ª—å–Ω–æ: `redis://localhost:6379`
  - –ù–∞ Vercel: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å (Upstash, Railway –∏ —Ç.–¥.)

- **`ENCRYPTION_KEY`** - –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤ –±–æ—Ç–æ–≤
  - –ú–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞
  - –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å: `node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"`

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

- **`FRONTEND_URL`** - URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–¥–ª—è CORS)
  - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://localhost:5173`
  - –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞: `https://lego-bot-frontend.vercel.app`

- **`ROUTER_URL`** - URL —Ä–æ—É—Ç–µ—Ä–∞ –¥–ª—è webhook
  - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://localhost:3001`
  - –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞: –≤–∞—à Cloudflare Tunnel URL

- **`PORT`** - –ø–æ—Ä—Ç API —Å–µ—Ä–≤–µ—Ä–∞
  - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `3000`

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è PostgreSQL

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker ps

# –ï—Å–ª–∏ –Ω–µ—Ç, –∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose up -d postgres

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs postgres
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Redis

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker ps

# –ï—Å–ª–∏ –Ω–µ—Ç, –∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose up -d redis

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs redis
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram API

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `DATABASE_URL` –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω: `docker ps`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `5433` (–Ω–µ `5432`)

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `REDIS_URL` –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω: `docker ps`
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è: `redis-cli -p 6379 ping`

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã

```bash
docker-compose down
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
docker-compose restart postgres redis
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ PostgreSQL

```bash
docker-compose logs -f postgres
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ Redis

```bash
docker-compose logs -f redis
```

### –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ë–î (–í–ù–ò–ú–ê–ù–ò–ï: —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!)

```bash
docker-compose down -v
docker-compose up -d postgres redis
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL

```bash
docker-compose exec postgres psql -U postgres -d dialogue_constructor -c "SELECT NOW();"
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis

```bash
docker-compose exec redis redis-cli ping
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞ (`/start`)
2. ‚úÖ –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞ (`/create_bot`)
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å—Ö–µ–º—É —á–µ—Ä–µ–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–±–æ—Ç—É —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –±–æ—Ç–∞

## üìû –ü–æ–º–æ—â—å

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Docker: `docker-compose logs`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `cat .env`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ —É @BotFather

